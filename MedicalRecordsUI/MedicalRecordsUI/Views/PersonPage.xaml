<Page
    x:Class="MedicalRecordsUI.Views.PersonPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModels="clr-namespace:MedicalRecordsUI.ViewModels"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    d:DataContext="{d:DesignInstance viewModels:PersonViewModel}">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,16">
            <TextBlock Text="Persons"
                       FontSize="28"
                       FontWeight="SemiBold" />
            <TextBlock Text="Manage persons in the system"
                       FontSize="16"
                       Opacity="0.7" />
        </StackPanel>

        <!-- Loading Indicator -->
        <ProgressRing Grid.Row="1"
                      IsActive="{Binding IsLoading}"
                      Visibility="{Binding IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Width="50"
                      Height="50" />

        <!-- Error Message -->
        <Border Grid.Row="1"
                Background="#FF4444"
                Padding="16"
                CornerRadius="8"
                Margin="0,0,0,16"
                Visibility="{Binding HasErrorMessage, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel Spacing="8">
                <TextBlock Text="Error"
                           FontWeight="SemiBold"
                           FontSize="16" />
                <TextBlock Text="{Binding ErrorMessage}"
                           TextWrapping="Wrap" />
            </StackPanel>
        </Border>

        <!-- Persons List -->
        <ListView x:Name="PersonsListView"
                   Grid.Row="1"
                   ItemsSource="{Binding Persons}"
                   Visibility="{Binding ShowPersonsList, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Border Background="#333"
                            Padding="16"
                            CornerRadius="8"
                            Margin="0,0,0,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Spacing="4">
                                <TextBlock Text="{Binding FirstName}"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Foreground="White" />
                                <TextBlock>
                                    <Run Text="{Binding LastName}" FontWeight="SemiBold" />
                                    <Run Text=" - " />
                                    <Run Text="{Binding DateOfBirth}" />
                                </TextBlock>
                                <TextBlock Text="{Binding Email}"
                                           Opacity="0.7"
                                           Visibility="{Binding Email, Converter={StaticResource StringToVisibilityConverter}}" />
                                <TextBlock Text="{Binding PhoneNumber}"
                                           Opacity="0.7"
                                           Visibility="{Binding PhoneNumber, Converter={StaticResource StringToVisibilityConverter}}" />
                            </StackPanel>

                            <StackPanel Grid.Column="1"
                                        Orientation="Horizontal"
                                        Spacing="8">
                                <Button Content="Edit"
                                        Command="{Binding DataContext.EditPersonCommand, ElementName=PersonsListView}"
                                        CommandParameter="{Binding}"/>
                                <Button Content="Delete"
                                        Command="{Binding DataContext.DeletePersonCommand, ElementName=PersonsListView}"
                                        CommandParameter="{Binding}" />
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- Empty State -->
        <TextBlock Grid.Row="1"
                   Text="No persons found."
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Opacity="0.5"
                   TextAlignment="Center"
                   Visibility="{Binding ShowEmptyState}" />
    </Grid>
</Page>

